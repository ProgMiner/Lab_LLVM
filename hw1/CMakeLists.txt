cmake_minimum_required(VERSION 3.16)
project(llvm-hw LANGUAGES C CXX)

set(SFML_BUILD_AUDIO FALSE)
set(SFML_BUILD_NETWORK FALSE)

include(FetchContent)
FetchContent_Declare(SFML
    GIT_REPOSITORY https://github.com/SFML/SFML.git
    GIT_TAG 2.6.x)

FetchContent_MakeAvailable(SFML)

add_executable(llvm-hw src/main.c src/sim.cpp src/sim.h src/sim.hpp src/log_llvm_ir.cpp)

target_link_libraries(llvm-hw PRIVATE sfml-graphics)

target_compile_features(llvm-hw PRIVATE c_std_11)
target_compile_features(llvm-hw PRIVATE cxx_std_17)

target_compile_options(llvm-hw PRIVATE -O2)

set_source_files_properties(src/main.c PROPERTIES
        COMPILE_FLAGS "-fpass-plugin='${PROJECT_BINARY_DIR}/../../cmake-debug-build/libTracePass.so'")
